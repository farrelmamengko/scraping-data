<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SKK Migas Tender</title>
    <!-- Font Awesome CDN (untuk ikon) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
    
    <!-- Gaya Dashboard -->
    <style>
        /* Reset dasar dan gaya body */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #ffffff; /* Latar Putih */
            color: #333333; /* Teks Hitam */
            line-height: 1.6;
            padding: 0 20px 40px 20px; /* Tambah padding bawah */
            margin: 0;
        }
        /* Header */
        .app-header {
            background-color: #ffffff; /* Putih */
            padding: 15px 40px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 40px;
            border-bottom: 2px solid #e71e25; /* Border Merah */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .app-header h1 {
            color: #e71e25; /* Merah */
            font-size: 1.8em;
            font-weight: 700;
            text-align: left;
            margin: 0;
        }
        /* Navigasi di dalam header */
        .app-header .app-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }
        .app-header .app-nav li {
            margin-right: 15px;
        }
        .app-header .app-nav a.nav-link {
            text-decoration: none;
            color: #333; /* Warna link standar */
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .app-header .app-nav a.nav-link:hover {
            background-color: #f0f0f0; /* Latar hover ringan */
            color: #e71e25; /* Warna teks hover merah */
        }
        .app-header .app-nav a.nav-link.active {
            background-color: #e71e25; /* Latar aktif merah */
            color: #ffffff; /* Teks aktif putih */
            font-weight: 500;
        }

        /* Pindahkan gaya tombol kembali ke sini karena posisinya berubah */
        .back-link-header {
            padding: 8px 18px;
            background-color: #e71e25; /* Merah */
            color: #ffffff; /* Putih */
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9em;
            transition: background-color 0.2s ease;
        }
        .back-link-header:hover {
            background-color: #c41219; /* Merah Gelap Hover */
            color: #ffffff;
            text-decoration: none;
        }
        /* Kontainer utama */
        .main-container { 
            max-width: 1600px; /* Perlebar kontainer utama */
            margin: 0 auto; 
            padding: 0 10px; 
        }
        /* Judul Section Global (untuk Ringkasan Data & Judul Utama Section Konten) */
        .section-title {
            color: #333333; /* Hitam */
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e71e25; /* Border Merah Tebal */
            font-weight: 600;
            font-size: 1.5em;
            display: flex; /* Untuk ikon */
            align-items: center; /* Sejajarkan ikon */
            gap: 10px; /* Jarak ikon dan teks */
        }
        
        /* Grid Statistik */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Sedikit lebih lebar min */
            gap: 25px;
            margin-bottom: 40px;
        }
        .stat-card {
            background-color: #ffffff; /* Putih */
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #eeeeee; /* Border Abu Terang */
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.04); /* Shadow lebih lembut */
            text-align: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; /* Transisi hover */
        }
        .stat-card:hover {
            transform: translateY(-3px); /* Efek angkat */
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.08); /* Shadow lebih jelas saat hover */
        }
        .stat-card i {
            font-size: 2.5em;
            color: #e71e25; /* Merah */
            margin-bottom: 15px;
            display: block;
            width: 50px; /* Pastikan ikon punya lebar tetap */
            height: 50px; /* Pastikan ikon punya tinggi tetap */
            line-height: 50px; /* Pusatkan ikon vertikal */
            background-color: #fff0f0; /* Latar merah muda */
            border-radius: 50%; /* Buat lingkaran */
            margin-left: auto; /* Pusatkan horizontal */
            margin-right: auto;
        }
        .stat-card h3 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 700;
            color: #333333; /* Hitam */
        }
        .stat-card p {
            margin: 5px 0 0;
            font-size: 1em;
            color: #666666; /* Abu */
            text-transform: uppercase; /* Buat label uppercase */
            font-size: 0.85em; /* Kecilkan label */
            font-weight: 500;
        }

        /* Wrapper untuk Konten Tengah */
        .dashboard-content-wrapper {
            display: grid;
            grid-template-columns: 1fr; /* Default satu kolom */
            gap: 30px; /* Jarak antar section */
        }

        @media (min-width: 992px) { /* Layout dua kolom untuk layar besar */
            .dashboard-content-wrapper {
                grid-template-columns: 2fr 1fr; /* Kalender lebih lebar */
            }
        }
        
        /* Gaya Section Konten */
        .content-section {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #e1e4e8; /* Border lebih halus */
            box-shadow: 0 1px 2px rgba(0,0,0,0.05); /* Shadow minimal */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; /* Efek hover halus */
        }
        .content-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.06); 
        }

        .content-section-title { /* Judul dalam setiap section */
            color: #333333; /* Hitam */
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e71e25; /* Border Merah Tipis */
            font-size: 1.3em; /* Sesuaikan ukuran judul dalam section */
            font-weight: 600;
            display: flex; /* Untuk ikon */
            align-items: center;
            gap: 10px;
        }
        
        /* Daftar Tender Terbaru - Compact */
        .latest-tenders-list-compact {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .latest-tenders-list-compact li {
            border-bottom: 1px solid #f0f0f0; /* Border pemisah halus */
            padding: 12px 0;
            display: flex;
            justify-content: space-between;
            align-items: center; /* Tengahkan vertikal */
            gap: 15px;
        }
        .latest-tenders-list-compact li:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        .tender-link {
            color: #e71e25; /* Warna link merah */
            text-decoration: none;
            flex-grow: 1; /* Biarkan link mengisi ruang */
            display: block; /* Agar bisa diklik seluruh area */
        }
        .tender-link:hover .tender-title-compact {
            text-decoration: underline;
        }
        .tender-title-compact {
            font-weight: 600;
            font-size: 0.95em;
            display: block; /* Judul di baris sendiri */
            margin-bottom: 3px;
            color: #333; /* Warna judul standar */
        }
         .tender-link:hover .tender-title-compact {
             color: #e71e25; /* Warna judul merah saat hover link */
         }

        .tender-meta-compact {
            font-size: 0.8em;
            color: #6c757d; /* Warna abu untuk meta */
            display: block;
        }
        /* Status badge (gunakan style .badge yang sudah ada) */
        .latest-tenders-list-compact .badge {
             flex-shrink: 0; /* Jangan biarkan badge mengecil */
        }
        
        /* Gaya untuk label New & Expired (digunakan di beberapa tempat) */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            font-size: 0.75em;
            font-weight: 600;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 15px; /* Pill shape */
        }
        .status-new { background-color: #198754; color: white; } /* Hijau Bootstrap */
        .status-open { background-color: #0d6efd; color: white; } /* Biru Bootstrap */
        .status-closed { background-color: #6c757d; color: white; } /* Abu-abu Bootstrap */
        .new-label { background-color: #28a745; color: #ffffff; } /* Hijau untuk label New di list */
        .expired-label { background-color: #dc3545; color: #ffffff; } /* Merah untuk label Expired */


        /* Gaya tambahan untuk kontainer kalender */
        #calendar-container {
            /* Sudah diatur oleh .content-section */
            margin-top: 0; /* Hapus margin-top jika sudah di grid gap */
        }
        /* Kustomisasi tampilan FullCalendar */
        .fc .fc-toolbar-title {
            font-size: 1.4em;
            color: #333333; /* Warna Judul Hitam */
        }
        .fc .fc-button-primary {
            background-color: #e71e25; /* Merah */
            border-color: #e71e25; /* Merah */
            color: #ffffff;
        }
        .fc .fc-button-primary:hover {
            background-color: #c41219; /* Merah Gelap Hover */
            border-color: #c41219;
        }
        /* Tombol Today */
        .fc .fc-today-button {
            background-color: #e71e25; /* Merah (atau warna lain jika diinginkan, mis: #6c757d abu-abu) */
            border-color: #e71e25;
            color: #ffffff;
        }
        .fc .fc-today-button:hover {
            background-color: #c41219;
            border-color: #c41219;
        }
        .fc .fc-daygrid-day.fc-day-today {
            background-color: #fff0f0; /* Latar merah muda untuk hari ini */
        }
        .fc-event {
            border: 1px solid #c41219; /* Border event lebih gelap */
            font-size: 0.8em; /* Kecilkan font event */
        }
        .fc-event:hover {
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        /* Navigasi Utama (di bawah header) */
        nav.app-nav { /* Lebih spesifik untuk navigasi utama */
            background-color: #f8f9fa;
            padding: 10px 40px;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 30px;
            display: flex;
            justify-content: flex-start; /* Mulai dari kiri */
        }
        nav.app-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 25px;
        }
        nav.app-nav a {
            text-decoration: none;
            color: #495057;
            font-weight: 500;
            padding: 8px 0;
            border-bottom: 3px solid transparent;
            transition: color 0.2s ease, border-bottom-color 0.2s ease;
            font-size: 0.95em;
        }
        nav.app-nav a:hover {
            color: #e71e25;
        }
        nav.app-nav a.active {
            color: #e71e25;
            border-bottom-color: #e71e25;
            font-weight: 600;
        }

    </style>
</head>
<body>

<header class="app-header">
    <h1>Dashboard SKK Migas</h1>
    <nav class="app-nav">
        <ul>
            <li><a href="/" class="nav-link">Daftar Tender</a></li>
            <li><a href="/tender-khusus" class="nav-link">Tender Perusahaan</a></li>
            <li><a href="/dashboard" class="nav-link active">Dashboard</a></li>
        </ul>
    </nav>
</header>

<!-- Navigasi Utama -->
<nav class="app-nav">
    <ul>
        <li><a href="/">Daftar Tender</a></li>
        <li><a href="/tender-khusus" class="nav-link">Tender Perusahaan</a></li>
        <li><a href="/dashboard" class="active">Dashboard</a></li> 
    </ul>
</nav>

<div class="main-container">

    <h2 class="section-title"><i class="fas fa-chart-pie"></i> Ringkasan Data</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <i class="fas fa-file-alt"></i>
            <h3><%= totalTenders %></h3>
            <p>Total Tender</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-tasks"></i>
            <h3><%= totalPrakualifikasi %></h3>
            <p>Prakualifikasi</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-gavel"></i>
            <h3><%= totalPelelangan %></h3>
            <p>Pelelangan Umum</p>
        </div>
    </div>

    <!-- Wrapper untuk Konten Tengah -->
    <div class="dashboard-content-wrapper">

        <!-- Kolom Kalender -->
        <div class="content-section" id="calendar-container">
            <h2 class="content-section-title"><i class="fas fa-calendar-alt"></i> Kalender Deadline Tender</h2>
            <div id='calendar'></div>
        </div>

        <!-- Section Tender Terbaru -->
        <div class="content-section">
            <h2 class="content-section-title"><i class="fas fa-list-ul"></i> Tender Terbaru</h2>
            <% if (latestTenders && latestTenders.length > 0) { %>
                <ul class="latest-tenders-list-compact">
                    <% latestTenders.forEach(tender => { %>
                        <li>
                            <a href="/?keyword=<%= encodeURIComponent(tender.judul) %>" class="tender-link"> 
                                <span class="tender-title-compact"><%= tender.judul.substring(0, 80) %><% if (tender.judul.length > 80) { %>...<% } %></span>
                                <span class="tender-meta-compact"><%= tender.tipe_tender %> | Batas: <%= tender.batasWaktu || 'N/A' %></span>
                            </a>
                            <% if (tender.isNew) { %>
                                <span class="badge new-label">New</span>
                            <% } %>
                        </li>
                    <% }); %>
                </ul>
            <% } else { %>
                <p>Belum ada data tender terbaru.</p>
            <% } %>
        </div>

    </div> <!-- Akhir .dashboard-content-wrapper -->

</div>

<!-- FullCalendar JS -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');
        
        const calendarEventsRaw = <%- JSON.stringify(calendarEvents || []) %>;
        
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek'
            },
            events: calendarEventsRaw,
            eventColor: '#e71e25', 
            eventTextColor: '#ffffff', 
            height: 'auto', 
            eventClick: function(info) {
                if (info.event.url) {
                    window.open(info.event.url, "_blank");
                    info.jsEvent.preventDefault();
                } else {
                    const props = info.event.extendedProps;
                    if (props && props.fullTitle) {
                        window.location.href = `/?keyword=${encodeURIComponent(props.fullTitle)}`;
                    } else {
                        console.warn('Data judul tidak ditemukan untuk event ini.');
                    }
                    info.jsEvent.preventDefault();
                }
            },
            eventDidMount: function(info) {
                if (info.event.extendedProps && info.event.extendedProps.fullTitle) {
                    info.el.setAttribute('title', info.event.extendedProps.fullTitle);
                }
            }
        });
        
        calendar.render();
    });
</script>

</body>
</html> 